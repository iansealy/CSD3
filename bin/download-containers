#!/usr/bin/env bash

rm -f "$HOME/containers/tmp"

for module in `find $HOME/privatemodules/ -type f | sort`; do
  container=`grep '\.sif$' $module | sed -e 's/^ *#*//' | awk '{ print $NF }'`
  if [ ! -f "$HOME/containers/$container" ]; then
    echo "$container downloading..."
    ( curl --progress-bar -o "$HOME/containers/tmp" "https://csd3.buschlab.org/containers/$container" \
      && mv "$HOME/containers/tmp" "$HOME/containers/$container" ) \
    || rm -f "$HOME/containers/tmp"
  else
    echo "$container already downloaded"
  fi
done
