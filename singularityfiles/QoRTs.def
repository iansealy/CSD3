Bootstrap: library
From: iansealy/alpine/alpine311:3.11.3

%labels
    Author Ian Sealy
    Version 1.3.6

%post
    apk --no-cache add R openjdk8-jre
    apk --no-cache add --virtual build-dependencies curl R-dev perl
    perl -spi -e 's/# (.*)\@CRAN\@(.*)/${1}https:\/\/cloud.r-project.org\/$2/' /usr/lib/R/library/base/R/Rprofile
    R --slave -e "update.packages(ask=FALSE)"
    R --slave -e "install.packages('https://github.com/hartleys/QoRTs/raw/099881f9c0e04b284848d4024ebd2ae768020251/QoRTs_1.3.6.tar.gz', repos=NULL, type='source')"
    mkdir -p /usr/local/share/java
    cd /usr/local/share/java
    curl -SsL 'https://github.com/hartleys/QoRTs/blob/v1.3.6/QoRTs.jar?raw=true' -o QoRTs.jar
    echo '#!/usr/bin/env sh
java -jar /usr/local/share/java/QoRTs.jar "$@"' > /usr/local/bin/qorts
    chmod a+x /usr/local/bin/qorts
    apk del build-dependencies

%environment
    export LANG=C.UTF-8
    export LC_ALL=C.UTF-8

%runscript
    /usr/local/bin/qorts "$@"

%apprun R
    /usr/bin/R "$@"

%apprun Rscript
    /usr/bin/Rscript "$@"

%help
    QoRTs - quality of RNA-seq tool-set
